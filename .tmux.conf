set-option -g focus-events on

set -g default-shell $SHELL
# set -g default-command "reattach-to-user-namespace -l ${SHELL}"

set -g default-terminal 'screen-256color'

set -ga terminal-overrides '*:Ss=\E[%p1%d q:Se=\E[ q'
set -ga terminal-overrides ",xterm-kitty:Tc"

set -g window-size largest
set-window-option -g aggressive-resize on

# a little heavy handed maybe, stops right click menu from appearing
# when mouse moves out of tmux popup, which happens pretty often when
# switching spaces
unbind MouseDown3Pane

# open pane in same dir
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# set base index to 1 for easier window/pane switching
set -g base-index 1
setw -g pane-base-index 1

set-option -sg escape-time 0
set-option -g history-limit 5000

# use vim like syntax when navigating buffer
set-window-option -g mode-keys vi

# Session mode: overlay or switch (full screen)
set -g @slot_mode overlay

bind C-o display-popup -E "tms"
bind C-s run-shell '~/dotfiles/scripts/session-switch'
bind C-c command-prompt -p "Session name:" "new-session -s '%%'"
bind M run-shell '~/dotfiles/scripts/toggle-session-mode'

bind C-h select-pane -L
bind C-j select-pane -D
bind C-k select-pane -U
bind C-l select-pane -R

# quick reload
bind R source-file '~/.tmux.conf'

bind-key C-h select-window -t 1
bind-key C-k select-window -t 2
bind-key C-e select-window -t 3
bind-key C-j select-window -t 4

# Agent pane toggle (left side, 30% width max 80 cols)
bind C-y run-shell '~/dotfiles/scripts/agentpane'
# Toggle focus between agent pane and pane to its right
bind y run-shell '~/dotfiles/scripts/agent-focus'
bind-key -T popup C-c send-keys -X cancel

bind-key h run-shell 'slotterm a'
bind-key k run-shell 'slotterm b'
bind-key e run-shell 'slotterm c'
bind-key j run-shell 'slotterm d'
bind-key t run-shell '~/dotfiles/scripts/toggle-overlay'

# enable visual selection with 'v' key
bind -T copy-mode-vi 'v' send -X begin-selection
# yank with 'y'
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'pbcopy' # 'xclip -in -selection clipboard'

# slideout with C-b then b
bind b select-pane -t 0 \; resize-pane -Z

# even out panes
unbind =
bind = select-layout even-horizontal

# don't rename windows automatically
set-option -g allow-rename off

# status bar
set-option -g status-bg black
set-option -g status-fg white

set -g status-justify left
set -g status-interval 60

# Left: truncated session name (last 20 chars)
set -g status-left-length 50
set -g status-left '#[fg=white]#{=/-20/...:session_name} '

# Right: state indicators (copy, zoomed, prefix), mode, and time
# Mode hidden when in slot session + overlay mode (already obvious from overlay)
set -g status-right-length 60
set -g status-right '#{?pane_in_mode,#[fg=colour245][copy] ,}#{?window_zoomed_flag,#[fg=colour245][zoomed] ,}#{?client_prefix,#[fg=colour245][prefix] ,}#{?#{&&:#{m:slot-*,#{session_name}},#{==:#{@slot_mode},overlay}},,#[fg=colour245]#{?#{==:#{@slot_mode},switch},--switch-- ,--overlay-- }}#[fg=white]%H:%M'

set -g pane-border-style fg=colour240
set -g pane-active-border-style fg=colour71

# Highlight active pane border
set -g pane-border-indicators arrows
set -g popup-border-style fg=colour243

setw -g monitor-activity off
set -g visual-activity off

# window status (matches slot indicator style)
set -g window-status-format '#[fg=colour240]#I:#W'
set -g window-status-current-format '#[fg=white]#I:#W'
set -g window-status-separator ' '

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'wfxr/tmux-fzf-url'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
