#!/bin/bash

# Ensure standard tmux sessions exist
# Usage: ensure-sessions [--attach]

# Session directories (session name = directory basename)
SESSION_DIRS=(
  "$HOME/projects/private/opine/platform-wta"
  "$HOME/projects/private/opine/platform-wtb"
  "$HOME/projects/private/opine/platform-wtc"
  "$HOME/projects/private/opine/platform-wtd"
  "$HOME/projects/private/opine/platform-wte"
  "$HOME/projects/private/opine/platform-wtf"
  "$HOME/dotfiles"
  "$HOME/projects/open-source/skim"
)

attach_first=false
if [[ "$1" == "--attach" ]]; then
  attach_first=true
fi

first_session=""

for path in "${SESSION_DIRS[@]}"; do
  name=$(basename "$path")

  if ! tmux has-session -t "$name" 2>/dev/null; then
    if [[ -d "$path" ]]; then
      tmux new-session -d -s "$name" -c "$path"
      echo "Created session: $name"
    else
      echo "Warning: Directory not found: $path"
    fi
  else
    echo "Session exists: $name"
  fi

  [[ -z "$first_session" ]] && first_session="$name"
done

# Optionally attach to first session
if $attach_first && [[ -n "$first_session" ]]; then
  if [[ -z "$TMUX" ]]; then
    tmux attach -t "$first_session"
  else
    tmux switch-client -t "$first_session"
  fi
fi
